<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>XML to JSON | Axoncodes production</title>
    <style>
        form#form { display: grid; }
        body { display: grid; }
    </style>
</head>
<body>
    <h1>Welcome to xmlandjson convertor</h1>
    <p>Upload your xml file or paste you code in textbox</p>
    <form id='form'>
        <p>INPUT</p>
        <textarea rows='10' id='code' name='code'></textarea>
        <input type='submit' value='Convert from textbox' />
        <input id='file' type='file' name='file' />
    </form>
    <p>OUTPUT</p>
    <textarea rows='10' id='resultcode'></textarea>
    <script>
        const server = 'https://axoncodes.com/xmlandjson';
        // const server = 'http://localhost:8001/xmlandjson';
        
        document.getElementById('form')
        .addEventListener('submit', async event => {
            event.preventDefault();
            await convertCode()
        })
        
        document.getElementById('file')
        .addEventListener('change', async event => { 
            await convertFile()
        })


        async function convertCode() {

            var formdata = new FormData();
            formdata.append('code', document.getElementById('code').value);
            await convertorApi({
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            })

        }


        async function convertFile() {

            var formdata = new FormData();
            formdata.append('file', document.getElementById('file').files[0], '/path/to/file');
            await convertorApi({
                method: 'POST',
                body: formdata,
                redirect: 'follow'
            })
            
        }


        async function convertorApi(requestOptions) {

            const result = await fetch(`${server}/convert`, requestOptions)
            .then(response => response.text())
            .catch(error => {alert(error); return 'error'});

            let resultJson = JSON.parse(result);

            document.getElementById('resultcode').value = 
                resultJson.status==400 
                    ? resultJson.message 
                    : JSON.stringify(resultJson.message);
        }


        
    </script>
</body>
</html>